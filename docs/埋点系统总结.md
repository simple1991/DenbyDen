# ğŸ“Š åŸ‹ç‚¹ç³»ç»Ÿå®æ–½æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ–‡æ¡£åˆ›å»º
- âœ… **åŸ‹ç‚¹è§„åˆ’è¯¦ç»†æ–‡æ¡£** (`docs/åŸ‹ç‚¹è§„åˆ’è¯¦ç»†æ–‡æ¡£.md`)
  - åŒ…å«æ‰€æœ‰é¡µé¢çš„åŸ‹ç‚¹è§„åˆ’
  - è¯¦ç»†çš„æ•°æ®å­—æ®µè¯´æ˜
  - ä¸ŠæŠ¥æ—¶æœºå’Œå®ç°è¦ç‚¹

- âœ… **Supabase æ•°æ®åº“è¡¨ç»“æ„** (`docs/supabase_schema.sql`)
  - 7ä¸ªæ•°æ®è¡¨çš„å®Œæ•´ç»“æ„
  - ç´¢å¼•ä¼˜åŒ–
  - RLS å®‰å…¨ç­–ç•¥

- âœ… **ä½¿ç”¨æŒ‡å—** (`docs/åŸ‹ç‚¹ä½¿ç”¨æŒ‡å—.md`)
  - ç¯å¢ƒé…ç½®è¯´æ˜
  - ç»„ä»¶é›†æˆç¤ºä¾‹
  - æ•°æ®æŸ¥çœ‹æ–¹æ³•

### 2. ä»£ç å®ç°
- âœ… **Supabase å®¢æˆ·ç«¯** (`lib/supabase.ts`)
  - é…ç½® Supabase è¿æ¥
  - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ç¡¬ç¼–ç  API Key

- âœ… **åŸ‹ç‚¹å·¥å…·åº“** (`lib/analytics.ts`)
  - å®Œæ•´çš„äº‹ä»¶ç±»å‹å®šä¹‰
  - æ‰¹é‡ä¸ŠæŠ¥æœºåˆ¶
  - é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
  - ç”¨æˆ·å’Œä¼šè¯ç®¡ç†

- âœ… **React Hooks** (`hooks/useAnalytics.ts`)
  - 9ä¸ªä¸“ç”¨ Hooks
  - ç®€åŒ–ç»„ä»¶é›†æˆ
  - è‡ªåŠ¨å¤„ç†æ›å…‰æ£€æµ‹ã€æ»šåŠ¨æ·±åº¦ç­‰

### 3. ä¾èµ–å®‰è£…
- âœ… å·²æ›´æ–° `package.json`ï¼Œæ·»åŠ  `@supabase/supabase-js`

---

## ğŸ“‹ å¾…å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾ç½®ï¼ˆå¿…é¡»ï¼‰
1. ç™»å½• Supabase Dashboard
2. æ‰§è¡Œ `docs/supabase_schema.sql` è„šæœ¬
3. éªŒè¯è¡¨ç»“æ„åˆ›å»ºæˆåŠŸ

### 2. ç»„ä»¶é›†æˆï¼ˆæŒ‰éœ€ï¼‰

#### é¦–é¡µ (`app/page.tsx`)
éœ€è¦æ·»åŠ ï¼š
- âœ… `usePageDwell('home')` - é¡µé¢åœç•™æ—¶é•¿
- âœ… `useScrollDepth('home')` - æ»šåŠ¨æ·±åº¦
- â³ åœ¨ `ProductGrid` ä¸­é›†æˆäº§å“æ›å…‰å’Œç‚¹å‡»

#### äº§å“å¡ç‰‡ (`components/ProductCard.tsx`)
éœ€è¦æ·»åŠ ï¼š
- â³ `useProductExposure` - äº§å“æ›å…‰
- â³ `useProductClick` - äº§å“ç‚¹å‡»
- â³ `useAddToCart` - åŠ å…¥è´­ç‰©è½¦

#### äº§å“è¯¦æƒ…é¡µ (`app/product/[slug]/page.tsx`)
éœ€è¦æ·»åŠ ï¼š
- â³ `useProductDetailView` - è¯¦æƒ…é¡µæŸ¥çœ‹
- â³ `usePageDwell('product_detail', productId)` - åœç•™æ—¶é•¿
- â³ `useImageSwipe` - å›¾ç‰‡æ»‘åŠ¨
- â³ `useSectionExpand` - æŠ˜å åŒºå±•å¼€
- â³ `useGiftWrappingToggle` - ç¤¼å“åŒ…è£…åˆ‡æ¢
- â³ `useAddToCart` - åŠ å…¥è´­ç‰©è½¦ï¼ˆè¯¦æƒ…é¡µç‰ˆæœ¬ï¼‰

#### é‚®ç®±å¼¹çª— (`components/EmailCaptureModal.tsx`)
éœ€è¦æ·»åŠ ï¼š
- â³ `useEmailSubmit` - é‚®ç®±æäº¤

#### äº§å“å±•ç¤ºé¡µ (`app/shop/page.tsx`)
éœ€è¦æ·»åŠ ï¼š
- â³ `usePageDwell('shop')` - é¡µé¢åœç•™æ—¶é•¿
- â³ `useScrollDepth('shop')` - æ»šåŠ¨æ·±åº¦
- â³ åœ¨ `ProductGrid` ä¸­é›†æˆäº§å“æ›å…‰å’Œç‚¹å‡»

#### å­ç±»å±•ç¤ºé¡µ (`app/shop/[category]/page.tsx`)
éœ€è¦æ·»åŠ ï¼š
- â³ `usePageDwell('category')` - é¡µé¢åœç•™æ—¶é•¿
- â³ `useScrollDepth('category')` - æ»šåŠ¨æ·±åº¦
- â³ åœ¨ `SubcategoryGrid` ä¸­é›†æˆäº§å“æ›å…‰å’Œç‚¹å‡»

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–
```bash
npm install
```

### æ­¥éª¤ 2: è®¾ç½®æ•°æ®åº“
1. è®¿é—® Supabase Dashboard
2. æ‰§è¡Œ `docs/supabase_schema.sql`

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
åˆ›å»º `.env.local`ï¼š
```env
NEXT_PUBLIC_SUPABASE_ANON_KEY=ä½ çš„API_KEY
```

### æ­¥éª¤ 4: é›†æˆåŸ‹ç‚¹
å‚è€ƒ `docs/åŸ‹ç‚¹ä½¿ç”¨æŒ‡å—.md` åœ¨ç»„ä»¶ä¸­é›†æˆç›¸åº”çš„ Hooks

### æ­¥éª¤ 5: æµ‹è¯•
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`
2. æµè§ˆç½‘ç«™ï¼Œè§¦å‘å„ç§äº‹ä»¶
3. åœ¨ Supabase Dashboard ä¸­æŸ¥çœ‹æ•°æ®

---

## ğŸ“Š æ•°æ®è¡¨ç»“æ„æ¦‚è§ˆ

| è¡¨å | ç”¨é€” | ä¸»è¦å­—æ®µ |
|------|------|----------|
| `events` | ä¸»äº‹ä»¶è¡¨ | event_type, event_category, page_type, user_id, session_id |
| `product_exposures` | äº§å“æ›å…‰ | product_id, position, list_type, viewport_position |
| `product_clicks` | äº§å“ç‚¹å‡» | product_id, position, click_type, source_page |
| `cart_actions` | è´­ç‰©è½¦æ“ä½œ | product_id, quantity, action_type, variant, gift_wrapping |
| `email_captures` | é‚®ç®±ç•™èµ„ | email, source_page, is_new_user |
| `page_interactions` | é¡µé¢äº¤äº’ | interaction_type, interaction_data, scroll_depth |
| `page_dwell_time` | é¡µé¢åœç•™ | page_type, dwell_time_seconds, is_bounce |

---

## ğŸ” æ•°æ®åˆ†æç¤ºä¾‹

### æŸ¥çœ‹ä»Šæ—¥äº§å“æ›å…‰æ’è¡Œ
```sql
SELECT 
  pe.product_id,
  pe.product_slug,
  COUNT(*) as exposure_count
FROM product_exposures pe
JOIN events e ON pe.event_id = e.id
WHERE DATE(e.timestamp) = CURRENT_DATE
GROUP BY pe.product_id, pe.product_slug
ORDER BY exposure_count DESC
LIMIT 10;
```

### æŸ¥çœ‹è½¬åŒ–æ¼æ–—
```sql
WITH funnel AS (
  SELECT 
    'æ›å…‰' as step,
    COUNT(*) as count
  FROM product_exposures pe
  JOIN events e ON pe.event_id = e.id
  WHERE DATE(e.timestamp) = CURRENT_DATE
  
  UNION ALL
  
  SELECT 
    'ç‚¹å‡»' as step,
    COUNT(*) as count
  FROM product_clicks pc
  JOIN events e ON pc.event_id = e.id
  WHERE DATE(e.timestamp) = CURRENT_DATE
  
  UNION ALL
  
  SELECT 
    'åŠ è´­' as step,
    COUNT(*) as count
  FROM cart_actions ca
  JOIN events e ON ca.event_id = e.id
  WHERE DATE(e.timestamp) = CURRENT_DATE
    AND ca.action_type = 'add'
)
SELECT * FROM funnel ORDER BY 
  CASE step
    WHEN 'æ›å…‰' THEN 1
    WHEN 'ç‚¹å‡»' THEN 2
    WHEN 'åŠ è´­' THEN 3
  END;
```

### æŸ¥çœ‹é¡µé¢è·³å‡ºç‡
```sql
SELECT 
  page_type,
  COUNT(*) as total_visits,
  SUM(CASE WHEN is_bounce THEN 1 ELSE 0 END) as bounces,
  ROUND(
    SUM(CASE WHEN is_bounce THEN 1 ELSE 0 END)::numeric / COUNT(*)::numeric * 100,
    2
  ) as bounce_rate
FROM page_dwell_time pdt
JOIN events e ON pdt.event_id = e.id
WHERE DATE(e.timestamp) = CURRENT_DATE
GROUP BY page_type;
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½ä¼˜åŒ–**
   - æ›å…‰ç±»äº‹ä»¶ä½¿ç”¨æ‰¹é‡ä¸ŠæŠ¥ï¼ˆ5ç§’æˆ–10æ¡ï¼‰
   - å…³é”®äº‹ä»¶ï¼ˆåŠ è´­ã€é‚®ç®±ï¼‰ç«‹å³ä¸ŠæŠ¥
   - ä½¿ç”¨ Intersection Observer ä¼˜åŒ–æ›å…‰æ£€æµ‹

2. **é”™è¯¯å¤„ç†**
   - ç½‘ç»œé”™è¯¯æ—¶æ•°æ®æš‚å­˜åˆ°é˜Ÿåˆ—
   - é¡µé¢é‡æ–°åŠ è½½æ—¶è‡ªåŠ¨é‡è¯•
   - æœ€å¤šé‡è¯•3æ¬¡

3. **éšç§ä¿æŠ¤**
   - ä¸æ”¶é›†ç”¨æˆ·IPåœ°å€
   - ä¸æ”¶é›†è®¾å¤‡æŒ‡çº¹
   - é‚®ç®±åœ°å€ä»…å­˜å‚¨ï¼Œä¸å®Œæ•´ä¸ŠæŠ¥

4. **æ•°æ®å»é‡**
   - åŒä¸€äº§å“åŒä¸€ä½ç½®çš„æ›å…‰åœ¨5ç§’å†…åªä¸ŠæŠ¥ä¸€æ¬¡
   - æ»šåŠ¨æ·±åº¦æ¯ä¸ªç™¾åˆ†æ¯”åªä¸ŠæŠ¥ä¸€æ¬¡

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `docs/åŸ‹ç‚¹è§„åˆ’è¯¦ç»†æ–‡æ¡£.md` - å®Œæ•´çš„åŸ‹ç‚¹è§„åˆ’
- `docs/åŸ‹ç‚¹ä½¿ç”¨æŒ‡å—.md` - ä½¿ç”¨ç¤ºä¾‹å’Œæ•…éšœæ’æŸ¥
- `docs/supabase_schema.sql` - æ•°æ®åº“è¡¨ç»“æ„

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®Œæˆæ•°æ®åº“è®¾ç½®
2. â³ åœ¨å…³é”®ç»„ä»¶ä¸­é›†æˆåŸ‹ç‚¹ Hooks
3. â³ æµ‹è¯•æ‰€æœ‰åŸ‹ç‚¹äº‹ä»¶
4. â³ éªŒè¯æ•°æ®æ­£ç¡®ä¸ŠæŠ¥
5. â³ åˆ›å»ºæ•°æ®åˆ†æçœ‹æ¿ï¼ˆå¯é€‰ï¼‰

